select substr(subsidiary.name,1,4) subsidiary, job.companyname projeto, job.custentity_rsc_term_cl_suspensiva inicioApropriacao   , Round((((abs((select sum(custrecord_rsc_un_emp_coef_aprop) valor from customrecord_rsc_unidades_empreendimento where  custrecord_rsc_un_emp_projeto =  job.id AND  custrecord_rsc_periodo_venda <=  161 and custrecord_rsc_un_emp_status in (7) ))) / (abs((select sum(custrecord_rsc_un_emp_coef_aprop) valor from customrecord_rsc_unidades_empreendimento where  custrecord_rsc_un_emp_projeto =  job.id))) )*100), 3)Perc_Vendido  , Round((((abs((select sum(amount) valor from (select sum(case when transactionaccountingline.credit > 0 then (transactionaccountingline.credit*-1) else transactionaccountingline.debit end ) amount, account.acctnumber, BUILTIN.DF(transaction.postingperiod),transaction.postingperiod, transactionline.subsidiary from transactionaccountingline, transaction, transactionline, account where transaction.id = transactionaccountingline.transaction and transaction.id = transactionline.transaction and transactionLine.id = TransactionAccountingLine.transactionline and transactionLine.transaction = TransactionAccountingLine.transaction and transaction.recordtype in ('journalentry', 'vendorbill') and transaction.custbody_rsc_projeto_obra_gasto_compra = job.id and account.id = transactionaccountingline.account /*and transactionline.mainline = 'T' */ group by account.acctnumber, BUILTIN.DF(transaction.postingperiod), transaction.postingperiod, transactionline.subsidiary) transacao where  subsidiary =  subsidiary.id AND  postingperiod <=  161 and acctnumber in ('2811030100', '2811030200') ))) / (abs((select sum(amount) valor from (select sum(case when transactionaccountingline.credit > 0 then (transactionaccountingline.credit*-1) else transactionaccountingline.debit end ) amount, account.acctnumber, BUILTIN.DF(transaction.postingperiod),transaction.postingperiod, transactionline.subsidiary from transactionaccountingline, transaction, transactionline, account where transaction.id = transactionaccountingline.transaction and transaction.id = transactionline.transaction and transactionLine.id = TransactionAccountingLine.transactionline and transactionLine.transaction = TransactionAccountingLine.transaction and transaction.recordtype in ('journalentry', 'vendorbill') and transaction.custbody_rsc_projeto_obra_gasto_compra = job.id and account.id = transactionaccountingline.account /*and transactionline.mainline = 'T' */ group by account.acctnumber, BUILTIN.DF(transaction.postingperiod), transaction.postingperiod, transactionline.subsidiary) transacao where  subsidiary =  subsidiary.id AND  postingperiod <=  161 and acctnumber in ('2811010100' , '2811010200') ))) )*100), 3)Perc_Recebido  , Round((((abs((select sum(amount) valor from (select sum(case when transactionaccountingline.credit > 0 then (transactionaccountingline.credit*-1) else transactionaccountingline.debit end ) amount, account.acctnumber, BUILTIN.DF(transaction.postingperiod),transaction.postingperiod, transactionline.subsidiary from transactionaccountingline, transaction, transactionline, account where transaction.id = transactionaccountingline.transaction and transaction.id = transactionline.transaction and transactionLine.id = TransactionAccountingLine.transactionline and transactionLine.transaction = TransactionAccountingLine.transaction and transaction.recordtype in ('journalentry', 'vendorbill') and transaction.custbody_rsc_projeto_obra_gasto_compra = job.id and account.id = transactionaccountingline.account /*and transactionline.mainline = 'T' */ group by account.acctnumber, BUILTIN.DF(transaction.postingperiod), transaction.postingperiod, transactionline.subsidiary) transacao where  subsidiary =  subsidiary.id AND  postingperiod <=  161 and acctnumber in ('1142510100', '1142530100', '1142570100', '1144010100') ))) / (abs((select sum(amount) valor from (select sum(case when transactionaccountingline.credit > 0 then (transactionaccountingline.credit*-1) else transactionaccountingline.debit end ) amount, account.acctnumber, BUILTIN.DF(transaction.postingperiod),transaction.postingperiod, transactionline.subsidiary from transactionaccountingline, transaction, transactionline, account where transaction.id = transactionaccountingline.transaction and transaction.id = transactionline.transaction and transactionLine.id = TransactionAccountingLine.transactionline and transactionLine.transaction = TransactionAccountingLine.transaction and transaction.recordtype in ('journalentry', 'vendorbill') and transaction.custbody_rsc_projeto_obra_gasto_compra = job.id and account.id = transactionaccountingline.account /*and transactionline.mainline = 'T' */ group by account.acctnumber, BUILTIN.DF(transaction.postingperiod), transaction.postingperiod, transactionline.subsidiary) transacao where  subsidiary =  subsidiary.id AND  postingperiod <=  161 and acctnumber in ('1142510100', '1142530100', '1142570100', '1144010100') ) + (select sum(custentity_rsc_aprop_custo_a_incorrer) valor from (select jb.* from job jb) orcamento where  orcamento.id =  job.id))) )*100), 3)POC from subsidiary, job                      where subsidiary.custrecordtpemp in (1,2) and job.custentity_rsc_aprop_subsidiaria = subsidiary.id and subsidiary.id in (241, 179, 247) order by 1